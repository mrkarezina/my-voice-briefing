# My Voice Briefing

## AoG Directory Info
**Short Description:** My Voice Briefing allows you to explore stories covering the voice space

**Long:** My Voice Briefing allows you to explore stories covering the voice space. My Voice Briefing covers stories about the Google Assistant and Alexa, as well as stories from Voicebot.ai and the Voice Summit blog. You can select one of the stories if you wish to hear a short summary. You can also choose to send yourself a link to the full story.
If you are interested in learning more about the tech, learn more about it here: https://www.vecgraph.com/technology/

### Invocations
- Talk to My Voice Briefing
- Ask My Voice Briefing for the latest stories about the Google Assistant
- Ask My Voice Briefing for the latest stories about Alexa

## Agent

### Voice
Uses En-GB male voice. Easier to listen to. Don’t match voices to specific locales.
En-AU is to fast.

### Content Sources
Use the rss-content endpoint in Wyzefind Core to get article data from RSS links. Send the RSS link to the API. RSS feeds generated by http://fetchrss.com

**Sources**
- Voicebot Google Assistant Specific: http://fetchrss.com/rss/5ce8c95d8a93f8d5098b45675ceabe268a93f8f85a8b4567.xml
- Voicebot Alexa Specific: http://fetchrss.com/rss/5ce8c95d8a93f8d5098b45675ceabe6c8a93f80c5b8b4567.xml
- Voicebot Siri Specific: http://fetchrss.com/rss/5ce8c95d8a93f8d5098b45675cfbc03d8a93f8e25d8b4567.xml
- Voicebot Cortana Specific: http://fetchrss.com/rss/5ce8c95d8a93f8d5098b45675cfbc0b98a93f898628b4567.xml
- Voicebot Bixby Specific: http://fetchrss.com/rss/5ce8c95d8a93f8d5098b45675cfbc0f38a93f866668b4567.xml


## Intents

### Intro. INTENT: “LAUNCH”
Send a request to Wyzefind API for all RSS links used in the voice app. Don’t add an await to the request, so the voice app continues.
This let’s the API load the articles into the cache so that when the voice app requests the articles, there is no timeout.

-Then go to InitialContentIntent

### Initial Content. INTENT: “InitialContentIntent”
Invoked by: show trending articles, go home, show me articles …

Can provide welcome message or help menu.
 Ask: Latest developments in _Topic1_ or _Topic2_
 
 
### List of topics INTENT: “ListOfTopicsIntent”
Displays the list of topics, possible RSS feed (See sources)
Prompts the user to invoke the intent for a specific topic.

Shows suggestion pills


### Specific Topic Intents INTENT: ie “AlexaStoriesIntent”
Same intent structure used for each RSS source, the only thing that changes is the RSS link used for fetching the articles and the introduction.

3 articles are presented similar to The Guardian Skill (See Action Blueprint, Headlines).
Text: Show title, image

**Voice:** Read the titles using an announcer voice, read the first sentence using a reading voice.

Create an SSML from the 5 headlines
This SSML should include transitions (1st, 2nd, 3rd …) [which should be replaced by human voice eventually].

**Ask:** Let me know which story you would like to explore.

-The ON_SELECT_HANDLER does not work on speakers so you must use Ordinal selection for now

Follow Up state: ORDINAL_SELECTION_STATE

#### Article Card design
Using the Jovo google assistant card builder. A list selecter of option items. The title is used as a synonym. And the title is used as the selection key. This card is shown while SSML is read.


### Select an Article. INTENT: “ON_ELEMENT_SELECTED”
This is automatically called after user select an element in the list by  Voice , tap, or Cardinal index. Save the selected article INDEX to the user data of the session.

-Then go to article info intent

### Select an Article. INTENT: “ORDINAL_SELECTION” CONTEXT: “Ordinal Selection”
This is a nested intent
Can only be invoked if there is a `this.followUpState(ORDINAL_SELECTION_STATE)` called before.

Handler exists to make selection work on Speakers where ON_ELEMENT_SELECTED does not work.
Has messed handlers that recognize 1st, 2nd, 3rd, … ordinals.
Save the selected article INDEX to the user data of the session. The index corresponds to the ordinal handler.

Set: `this.$user.$data.ordinalSelection = true`
If variable is set to true in  Unhandled() because user did not use ordinal selection, reprompt asking: “Would that be the 1st, 2nd, or 3rd story”.

-Then go to article info intent


### Get Article Info Card INTENT: “ArticleInfoIntent”
Uses the article data stored in session variable to create an info card on the selected title.

Speak: The introduction of the article
Show: Image, Title, Description, Link to read full

Ask: Next story or the list of topics?



### Email story link INTENT: “EmailArticleLinkIntent”
If the user is signed in get their email from `this.$user.$data.email `
Send the email containing information on the story using the SendGrid API
From: noreply@assistant.vecgraph.com

Use node.js client to populate the template variables and send
Design transactional email template and get templateID
https://github.com/sendgrid/sendgrid-nodejs/blob/master/use-cases/transactional-templates.md


Ask: What to do next? SELECT_NEXT_MOVE
If Account linking fails: ^ same thing

Use this.$user.$data.accountData to check if the user is signed in.
If not use return this.showAccountLinkingCard(); [Guide](https://www.jovo.tech/docs/data#account-linking).
Handle the sign in ON_SIGN_IN() intent.

**Client ID issued to your action:** 637892352374-bs0jp60e15dtv1nrptpcg3b4etsdgpd3.apps.googleusercontent.com


#### ON_SIGN_IN()
See guide for decoding signed in user data

let token = this.$request.originalDetectIntentRequest.payload.user.idToken;
const decodedData = jwt.decode(token);

Redirect: Back to EmailStoryIntent

### Next story (YES or NO) INTENT: “NextStoryIntent”
Can only be invoked if there is a this.followUpState(‘SelectNextMove’) called before.

This intent increases the index of the selected article and redirects to ArticleInfoIntent.


### Get Help, or what can you do INTENT: “HelpIntent”
Invoked when the user says something along the lines of, help, what can you you.

The help Intent talks about what the Action can do.

Solution to redirects with a message: Redirects to initial content. Initial content checks if isHelp variable is true and can add a help message.

(If articles) Ask: Looks like you where exploring …, want to see related?
(No articles) Ask: Would you like to see some trending articles?


### About Intent: AboutIntent
Just used to give the use more information about the Bot, and vecgraph website. Leaves an open response. User can trigger help intent, or initial content intent.

Send a message to vecgraph

### Unhandled [Fallback intent]:
Set a follow up state TRY_AGAIN for routing the Yes / No intents in this context.
Ask Random choice from: ["I had trouble understanding.", "I’m sorry. I’m having some trouble understanding what you said.", "I didn’t quite get that."]

Asks: Does user want to go back?
NOTE: The YesIntent is trained to recoginze “go back” as a phrase if the user chooses to repeat the question instead of saying yes.





## Issues
- RSS links will expire and stop working if not used for over 24h. Currently AoG health checks (every 5 min) make sure the RSS links are constantly used.



## Project Assets
- **Bitbucket**: my-voice-briefing
- **Content**: [my-voice-briefing CMS](https://docs.google.com/spreadsheets/d/1R5k907bpjR1krDXwxHlC8ikpDeN0OS4fXJiuoDz33Ig/edit#gid=705481599)
- **Dialogflow**: my-voice-briefing
- **Google cloud**: wyzefind-jovo-integration
- **Analytics**: Dashbot
